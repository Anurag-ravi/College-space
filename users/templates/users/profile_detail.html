{% extends "main/basic.html" %}
{% block content %}
{% load crispy_forms_tags %}
<div class="row justify-content-around">
    <div class="boxed col-6 border border-1 border-primary bg-light" style="height:80vh;">
        <div class="jumbotron p-4">
        <img src="{{object.avatar.url}}" class="rounded-circle z-depth-2" alt="{{object.name}}" style="width:20%;height:20%;">
        <h3 style="letter-spacing:2px;text-shadow:2px 2px #1d1b31;display: inline-block;" class="mb-2 float-left">{{object.name}}</h3>
        {% if object.br %}
            <div type="button" style="float:right;" class="badge rounded-pill bg-success" >BR</div>
        {% endif %}
        <hr>
        <h5 class="my-2 text-wrap">Bio : {{object.bio}}</h5>
        <hr>
        <h5 class="my-2 text-wrap">Email : {{object.user.email}}</h5>
        <h5 class="my-2">Roll No : {{object.roll}} </h5>
        <h5 class="my-2">Batch : {{object.batch}} </h5>
        <h5 class="my-2">Department : {{object.department}} </h5>
        {% if object.section != '0' %}
            <h5 class="my-2">Section : {{object.section}} </h5>
        {% endif %}
        <h5 class="my-2">No. of Friends : {{object.get_friends_no}} </h5>
        <h5 class="my-2">No. of Posts : {{object.get_post_no}} </h5>
        <div class="col-3">
                {% if object.user not in rel_receiver and object.user not in rel_sender %}
                    <form action="{% url 'send-invites'%}" method="POST">
                        {%csrf_token%}
                        <input type="hidden" name="profile_pk" value="{{object.pk}}">
                        <button class="btn btn-success" type="submit">Add Friend</button>
                    </form>
                {% endif %}
                {% if object.user in rel_receiver and request.user not in object.friends.all %}
                    <button class="btn btn-secondary" type="submit" disabled>Request Sent</button>
                {% endif %}
                {% if request.user in object.friends.all %}
                    <form action="{% url 'remove-friend'%}" method="POST">
                        {%csrf_token%}
                        <input type="hidden" name="profile_pk" value="{{object.pk}}">
                        <button class="btn btn-danger" type="submit">Remove Friend</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% if len_posts %}
    <div class="col-5 bg-light">
        {% for post in posts %}
            <div class="container my-3 bg-light border ">
                <div class="d-flex py-2 mb-2 border-bottom">
                    <img src="{{post.author.avatar.url}}" class="rounded-circle z-depth-2" alt="{{user.profile.name}}" style="width:12%;height:12%; display:inline-block;">
                    <a href="#" class="text-dark pt-2 ps-2 flex-grow-1"><h3>{{post.author.name}}</h3></a>
                    {% if post.author == request.user.profile %}
                        <a href="{% url 'post-update' post.pk%}" data-toggle="tooltip" data-placement="right" title="Update Post" class="text-dark"><i class='bx bx-message-rounded-edit p-2 bx-sm'></i></a>
                        <a href="{% url 'post-delete' post.pk%}" data-toggle="tooltip" data-placement="right" title="Delete Post" class="text-dark"><i class='bx bx-message-rounded-x p-2 bx-sm'></i></a>
                    {% endif %}
                </div>
                <p class="text-break border-bottom pb-1 text-muted">{{post.created|timesince}} ago</p>
                <p class="text-break text-dark">{{post.content}}</p>
                {% if post.image %}
                    <img src="{{post.image.url}}" class="z-depth-2" alt="{{user.profile.name}}" style="width:100%;">
                {% endif %}
                <div class="d-flex py-2 mb-2">
                    <form class="me-2" action="{% url 'like_unlike'%}" method="POST">
                    {% csrf_token %}
                        <input type="hidden" name="post_id" value={{post.id}}>
                        <button class="btn btn-danger" type="submit">
                        {% if profile not in post.liked.all %}
                            <i class='bx bx-sm mx-2 bx-heart'></i>
                        {% else %}
                            <i class='bx bx-sm mx-2 bxs-heart'></i>
                        {% endif %}
                        </button>
                    </form>
                    {% if profile not in post.liked.all %}
                    Liked by {{post.num_likes}} others
                    {% else %}
                        Liked by you and  {{post.num_likes_one}} others
                    {% endif %}
                </div>
                {% if post.num_comments == 0 %}
                {% else %}
                    <p class="commentbtn">all {{post.num_comments}} comments</p>
                    <div class="overflow-auto commentbox" style="height:100px;">
                        {% if post.comment_set.all %}
                            {% for c in post.comment_set.all %}
                            <div class="text-break py-1 d-flex">
                                <img src="{{c.user.avatar.url}}" class="rounded-circle z-depth-2" style="width:5%;height:5%; display:inline-block;">
                                <span class="ps-2"> {{c.user.name }} : {{c.body}}</span>
                                {% if c.user == request.user.profile %}
                                    <a href="{% url 'com-update' c.pk%}" data-toggle="tooltip" data-placement="right" title="Update Comment" class="text-dark pb-1"><i class='bx bx-message-rounded-edit p-2 bx-xs'></i></a>
                                    <a href="{% url 'com-delete' c.pk%}" data-toggle="tooltip" data-placement="right" title="Delete Comment" class="text-dark pb-1"><i class='bx bx-message-rounded-x p-2 bx-xs'></i></a>
                                {% elif c.post.author == request.user.profile %}
                                    <a href="{% url 'com-delete' c.pk%}" data-toggle="tooltip" data-placement="right" title="Delete Comment" class="text-dark pb-1"><i class='bx bx-message-rounded-x p-2 bx-xs'></i></a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endif %}
                <form method="POST">
                    {% csrf_token %}
                        <input type="hidden" name="post_id" value={{post.id}}>
                        {{ c_form|crispy }}
                    <div class="form-group my-2">
                    <button class="btn btn-primary" id="update" name="c_submit" type="submit">Comment</button>
                    </div>
                </form>
            </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}